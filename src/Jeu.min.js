"use strict";var CasseBrique=CasseBrique||{};CasseBrique.Jeu=function(){this.barre=null,this.balleSurBarre=null,this.ballesRestantes=null,this.balle=null,this.lesBriques=null,this.scoreTxt=null,this.tableauSons=[]},CasseBrique.Jeu.prototype={init:function(){CasseBrique.score=0,this.ballesRestantes=5,CasseBrique.tempsJeu=0,CasseBrique.nbNiveau=1,this.balleSurBarre=!0},create:function(){this.add.image(0,0,"arrierePlanImg"),this.tableauSons[0]=this.add.audio("sonJeu1",1),this.tableauSons[1]=this.add.audio("sonJeu2",1),this.tableauSons[2]=this.add.audio("sonJeu3",1),this.tableauSons[3]=this.add.audio("sonJeu4",1),this.tableauSons[4]=this.add.audio("sonJeu5",1),this.tableauSons[5]=this.add.audio("sonJeu6",1),this.choisirSonJeu(),this.physics.startSystem(Phaser.Physics.ARCADE),this.physics.arcade.checkCollision.down=!1,this.scoreTxt=this.add.text(50,this.game.height,"Score: 0",{font:"15px Arial",fill:"#ffffff",align:"left"}),this.scoreTxt.anchor.set(.5,1),this.tempsTxt=this.add.text(20,10,"Temps: 0",{font:"15px Arial",fill:"#ffffff",align:"left"}),this.ballesRestantesTxt=this.add.text(this.game.width-75,this.game.height,"Balles restantes : 5",{font:"15px Arial",fill:"#ffffff",align:"left"}),this.ballesRestantesTxt.anchor.set(.5,1),this.barre=this.add.sprite(this.world.centerX,585,"barreImg"),this.physics.enable(this.barre,Phaser.Physics.ARCADE),this.barre.body.immovable=!0,this.barre.anchor.setTo(.5,0),this.barre.inputEnabled=!0,this.barre.input.useHandCursor=!0,this.barre.input.enableDrag(),this.barre.input.allowVerticalDrag=!1,this.barre.events.onDragUpdate.add(this.verifierPositionBarre,this),this.creerBriques(),this.creerBalle();var e={font:"45px Calibri",fill:"#ffffff",align:"center"};if(this.compteurNiveaux=new CompteurNiveaux(this.game,this.world.centerX,0,"Niveau 1",e),this.game.device.desktop||this.game.device.android){var i=this.add.button(this.game.width-5,5,"pleinEcranBtn",this.gererPleinEcran,this);this.game.scale.isFullScreen?i.frame=1:i.frame=0,i.anchor.set(1,0)}this.time.events.loop(Phaser.Timer.SECOND,this.augmenterTemps,this)},gererPleinEcran:function(e){this.game.scale.isFullScreen?(Ecran.enleverPleinEcran(),e.frame=0):(Ecran.mettrePleinEcran(),e.frame=1),this.game.device.android&&Ecran.verrouillerEcran(Ecran.PAYSAGE)},choisirSonJeu:function(){var e=this.rnd.between(0,5);this.tableauSons[e].play(),this.tableauSons[e].onStop.add(this.choisirSonJeu,this)},augmenterTemps:function(){CasseBrique.tempsJeu++,this.tempsTxt.text="Temps : "+CasseBrique.tempsJeu},verifierPositionBarre:function(){this.barre.x<=0?this.barre.x=0:this.barre.x+(this.barre.width-125)>=this.game.width&&(this.barre.x=this.game.width-this.barre.width+121)},creerBalle:function(){this.balle=this.add.sprite(this.world.centerX,this.barre.y-8,"balleImg"),this.balle.anchor.set(.5),this.balle.animations.add("rotationBalle",null,6,!0,!1),this.balle.checkWorldBounds=!0,this.game.physics.enable(this.balle,Phaser.Physics.ARCADE),this.balle.body.collideWorldBounds=!0,this.balle.body.bounce.set(1),this.balle.body.setSize(16,16,0,0),this.balle.events.onOutOfBounds.add(this.gererBallePerdue,this),this.input.onTap.add(this.lancerBalle,this)},creerBriques:function(){this.lesBriques=this.add.physicsGroup(Phaser.Physics.ARCADE);for(var e,i,s,a=[[80,324],[134,324],[188,324],[242,324],[296,324],[350,324],[404,324],[458,324],[512,324],[566,324],[620,324],[674,324],[728,324],[782,324],[836,324],[80,243],[134,243],[188,243],[242,243],[296,243],[350,243],[404,243],[458,243],[512,243],[566,243],[620,243],[674,243],[728,243],[782,243],[836,243],[80,162],[134,162],[188,162],[242,162],[296,162],[350,162],[404,162],[458,162],[512,162],[566,162],[620,162],[674,162],[728,162],[782,162],[836,162],[80,81],[134,81],[188,81],[242,81],[296,81],[350,81],[404,81],[458,81],[512,81],[566,81],[620,81],[674,81],[728,81],[782,81],[836,81]],t=[[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19]],r=0;r<60;r++)e=a[r][0],i=a[r][1],s=this.lesBriques.create(e,i,"briquesImg"),this.game.device.desktop&&(s.animations.add("disparitionBriqueBleu",t[0],20,!1),s.animations.add("disparitionBriqueJaune",t[1],20,!1),s.animations.add("disparitionBriqueRouge",t[2],20,!1),s.animations.add("disparitionBriqueVerte",t[3],20,!1)),r<15&&(s.frame=10,CasseBrique.nbNiveau>1&&(this.animBrique1=this.add.tween(s).to({x:s.x,y:365},3e3,Phaser.Easing.Linear.None,!0,0,-1,!0)),CasseBrique.nbNiveau>=3&&(this.animBrique1.timeScale=3),CasseBrique.nbNiveau>=4&&r%2==0&&(this.animBrique1=this.add.tween(s).from({x:s.x,y:325},1e3,Phaser.Easing.Linear.None,!0,0,-1,!0)),5==CasseBrique.nbNiveau&&r%2!=0&&(this.animBrique1=this.add.tween(s).from({x:s.x,y:405},1e3,Phaser.Easing.Linear.None,!0,0,-1,!0))),r>=15&&r<30&&(s.frame=5,CasseBrique.nbNiveau>1&&(this.animBrique2=this.add.tween(s).to({x:s.x,y:243},2e3,Phaser.Easing.Linear.None,!0,0,-1,!0)),CasseBrique.nbNiveau>=3&&(this.animBrique2.timeScale=3),CasseBrique.nbNiveau>=4&&r%2==0&&(this.animBrique2=this.add.tween(s).from({x:s.x,y:203},1e3,Phaser.Easing.Linear.None,!0,0,-1,!0)),5==CasseBrique.nbNiveau&&r%2!=0&&(this.animBrique1=this.add.tween(s).from({x:s.x,y:283},1e3,Phaser.Easing.Linear.None,!0,0,-1,!0))),r>=30&&r<45&&(s.frame=15,CasseBrique.nbNiveau>1&&(this.animBrique3=this.add.tween(s).to({x:s.x,y:182},2e3,Phaser.Easing.Linear.None,!0,0,-1,!0)),CasseBrique.nbNiveau>=3&&(this.animBrique3.timeScale=3),CasseBrique.nbNiveau>=4&&r%2==0&&(this.animBrique3=this.add.tween(s).from({x:s.x,y:122},1e3,Phaser.Easing.Linear.None,!0,0,-1,!0)),5==CasseBrique.nbNiveau&&r%2!=0&&(this.animBrique1=this.add.tween(s).from({x:s.x,y:202},1e3,Phaser.Easing.Linear.None,!0,0,-1,!0))),r>=45&&r<60&&(s.frame=0,CasseBrique.nbNiveau>1&&(this.animBrique4=this.add.tween(s).to({x:s.x,y:50},3e3,Phaser.Easing.Linear.None,!0,0,-1,!0)),CasseBrique.nbNiveau>=3&&(this.animBrique4.timeScale=3),CasseBrique.nbNiveau>=4&&r%2==0&&(this.animBrique4=this.add.tween(s).from({x:s.x,y:30},1e3,Phaser.Easing.Linear.None,!0,0,-1,!0)),5==CasseBrique.nbNiveau&&r%2!=0&&(this.animBrique1=this.add.tween(s).from({x:s.x,y:110},1e3,Phaser.Easing.Linear.None,!0,0,-1,!0)));this.lesBriques.setAll("body.immovable",!0)},update:function(){this.game.device.desktop&&(this.barre.x=this.input.x),!0===this.balleSurBarre?this.balle.body.x=this.barre.x:(this.game.physics.arcade.collide(this.balle,this.barre,this.gererCollisionEntreBarreEtBalle,null,this),this.game.physics.arcade.collide(this.balle,this.lesBriques,this.gererCollisionEntreBalleEtBrique,null,this))},lancerBalle:function(){1==this.balleSurBarre&&(5==CasseBrique.nbNiveau?(this.balle.body.velocity.y=-500,this.balle.body.velocity.x=-200):4==CasseBrique.nbNiveau?(this.balle.body.velocity.y=-450,this.balle.body.velocity.x=-200):3==CasseBrique.nbNiveau?(this.balle.body.velocity.y=-400,this.balle.body.velocity.x=-120):(this.balle.body.velocity.y=-300,this.balle.body.velocity.x=-75),this.balleSurBarre=!1,this.balle.animations.play("rotationBalle"))},gererCollisionEntreBarreEtBalle:function(e,i){var s=0;e.x<i.x?(s=i.x-e.x,e.body.velocity.x=-10*s):e.x>i.x&&(s=e.x-i.x,e.body.velocity.x=10*s)},gererCollisionEntreBalleEtBrique:function(e,i){switch(this.add.audio("sonCollisionBrique",1).play(),CasseBrique.score+=10,this.scoreTxt.text="Score: "+CasseBrique.score,i.frame){case 0:if(this.game.device.desktop){var s=i.play("disparitionBriqueBleu");s.killOnComplete=!0}else i.destroy();break;case 5:this.game.device.desktop?(s=i.play("disparitionBriqueJaune")).killOnComplete=!0:i.destroy();break;case 10:this.game.device.desktop?(s=i.play("disparitionBriqueRouge")).killOnComplete=!0:i.destroy();break;case 15:this.game.device.desktop?(s=i.play("disparitionBriqueVerte")).killOnComplete=!0:i.destroy()}this.game.device.desktop?1==this.lesBriques.countLiving()&&this.accederNiveauSuivant():0==this.lesBriques.countLiving()&&this.accederNiveauSuivant()},gererBallePerdue:function(){this.ballesRestantes--,this.ballesRestantesTxt.text="Balles restantes : "+this.ballesRestantes,0===this.ballesRestantes?this.allerFinJeu():(this.balleSurBarre=!0,this.balle.reset(this.barre.body.x,this.barre.y-8),this.balle.animations.stop())},accederNiveauSuivant:function(){if(CasseBrique.nbNiveau+=1,CasseBrique.nbNiveau<6){CasseBrique.score+=250,this.scoreTxt.text="score: "+CasseBrique.score;var e={font:"45px Calibri",fill:"#ffffff",align:"center"},i="Niveau "+CasseBrique.nbNiveau;this.compteurNiveaux=new CompteurNiveaux(this.game,this.world.centerX,0,i,e),this.balleSurBarre=!0,this.balle.reset(this.barre.body.x,this.barre.y-8),this.balle.animations.stop(),this.creerBriques()}else this.allerFinJeu()},allerFinJeu:function(){for(var e=0;e<6;e++)this.tableauSons[e].pause();this.game.state.start("FinJeu")}};